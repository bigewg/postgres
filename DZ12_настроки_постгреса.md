1. Создаем виртуалку (2CPU 4Gb) и устанавливаем постгрес 14.   
```
-- установка 15 ПГ
sudo apt update && sudo apt upgrade -y -q && sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list' && wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add - && sudo apt-get update && sudo apt -y install postgresql-15
```

2. Инициализируем pgbench и запускаем его, чтобы было с чем сравнивать при настройке
```
postgres@dz12:~$ pgbench -i tune  
postgres@dz12:~$ pgbench -c 50 -j 2 -P 10 -T 60 tune  
...
tps = 573.114127 (without initial connection time)  
```  
<details>
<summary>Полный результат запуска pgbench до изменения настроек: </summary>  
  
pgbench (15.2 (Ubuntu 15.2-1.pgdg22.04+1))  
starting vacuum...end.  
progress: 10.0 s, 476.8 tps, lat 102.722 ms stddev 119.512, 0 failed  
progress: 20.0 s, 582.2 tps, lat 86.712 ms stddev 96.738, 0 failed  
progress: 30.0 s, 661.8 tps, lat 75.303 ms stddev 69.026, 0 failed  
progress: 40.0 s, 583.8 tps, lat 85.287 ms stddev 85.399, 0 failed  
progress: 50.0 s, 507.1 tps, lat 98.089 ms stddev 100.989, 0 failed  
progress: 60.0 s, 626.0 tps, lat 80.594 ms stddev 94.691, 0 failed  
transaction type: <builtin: TPC-B (sort of)>  
scaling factor: 1  
query mode: simple  
number of clients: 50  
number of threads: 2  
maximum number of tries: 1  
duration: 60 s  
number of transactions actually processed: 34427  
number of failed transactions: 0 (0.000%)  
latency average = 87.124 ms  
latency stddev = 94.567 ms  
initial connection time = 61.261 ms  
tps = 573.114127 (without initial connection time)  
</details>

4. Запускаем pgtune 
https://pgtune.leopard.in.ua/#/

3. Меняем параметры, предложенные нам:

max_connections = 100
shared_buffers = 1GB
effective_cache_size = 3GB
maintenance_work_mem = 256MB
checkpoint_completion_target = 0.9
wal_buffers = 16MB
default_statistics_target = 100
random_page_cost = 4
effective_io_concurrency = 2
work_mem = 2621kB
min_wal_size = 1GB
max_wal_size = 4GB

включаем асинхронный режим
 synchronous_commit = off
